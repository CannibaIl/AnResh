<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Employees</title>    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="../css/index.css" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
</head>
<body>
    <header>
    </header>

    <div id="error" class="container alert alert-danger mt-3" style="display: none"></div>

    <div id="content" class="container mt-3" style="display: none">
        <table id="table" class="table table-bordered">
            <thead>
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">FirstName</th>
                    <th scope="col">LastName</th>
                    <th scope="col">MidleName</th>
                    <th scope="col">DepartmentID</th>
                    <th scope="col">Salary</th>
                </tr>
            </thead>
        </table>
    </div>

    <script>

        function getEmployeesList(requestUrl) {
            $.get(requestUrl, function (data) {
                if ($.isEmptyObject(data)) {
                    $('#error').text("not found").slideDown();
                }
                else {
                    $('#table').append(
                        `<tbody>${data.map(e =>
                            `<tr>
                                <th scope="row">${e.id}</td>
                                <td>${e.firstName}</td>
                                <td>${e.lastName}</td>
                                <td>${e.midleName}</td>
                                <td>${e.departmentId}</td>
                                <td>${e.salary} $</td>
                             </tr>`).join('')}
                        </tbody>`
                    );
                    $('#content').css('display', 'block')
                }
            }).fail(function (xhr) {
                var msg = 'A server communication error occured. Server returns response code ' + xhr.status;
                displayError(msg);
            });
        }

        $(document).ready(function () {
            $("header").load('../pageComponents/header.html');

            var baseUrl = (window.location).href;
            var departamentId = baseUrl.substring(baseUrl.lastIndexOf('/') + 1);

            if (isNaN(departamentId) || departamentId == "") {
                getEmployeesList('/api/employee');
            }
            else {
                getEmployeesList('/api/employee/department/' + departamentId);
            }

        });

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
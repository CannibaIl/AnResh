<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>File</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="../css/index.css" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>

<body>

    <header>
    </header>

    <div id="content" class="container mt-3">
        <div id="error" class="alert alert-danger" style="display: none"></div>
        <div id="saved-success" class="alert alert-success" style="display: none">File saved successfully</div>

        <form id="form">
            <div class="btn-group mb-3">
                <input type="button" class="updateFile btn btn-primary" onclick="readFile()" value="Обновить файл" />
                <input type="submit" class="btn btn-success" value="Сохранить изменения" />
            </div>

            <textarea multiple class="form-control mb-3" id="text" type="text" name="text"
                      style="height: 70vh; overflow-y: scroll;"></textarea>
        </form>
    </div>



    <script>

        $("#form").submit(function (e) {
            e.preventDefault();
            hideAlerts();
            var form_data = $(this).serialize();
            $.post('/api/file', form_data)
                .done(function () {
                    displaySuccess();
                })
                .fail(function (xhr) {
                    var msg = 'A server communication error occured. Server returns response code ' + xhr.status;
                    displayError(msg);
                });
        });

        $('#refresh-btn').click(function () {
            readFile();
            return false;
        });

        function readFile() {
            hideAlerts();
            $.get('/api/file', function (data) {
                $('#text').val(data);
            }).fail(function (xhr) {
                var msg = 'A server communication error occured. Server returns response code ' + xhr.status;
                displayError(msg);
            });
        }

        function displayError(msg) {
            $('#error').text(msg).slideUp();
        }

        function displaySuccess() {
            $('#saved-success').slideDown();
        }

        function hideAlerts() {
            $('#error').slideUp();
            $('#saved-success').slideUp();
        }

        $(document).ready(function () {
            $("header").load('../pageComponents/header.html');
            readFile();
        });

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous">


    </script>
</body>

</html>